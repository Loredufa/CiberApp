# nginx/zz_app.conf
# Docroot real del build
root /usr/share/nginx/html;
index index.html;

# SPA React/Vite
location / {
  try_files $uri /index.html;
}

# Logs en stdout/err (Ãºtil en OpenShift)
access_log /dev/stdout;
error_log  /dev/stderr;

# Reverse proxy a n8n
location /webhook/nist-csf {
  proxy_pass https://n8n-n8n.apps.focus-ocp-sno-virt.datco.net/webhook/nist-csf;
  proxy_ssl_server_name on;
  proxy_ssl_verify off;
  proxy_set_header Host $host;
  proxy_set_header X-Forwarded-Proto $scheme;
  proxy_set_header X-Forwarded-For $remote_addr;
}
location /webhook/pentest {
  proxy_pass https://n8n-n8n.apps.focus-ocp-sno-virt.datco.net/webhook/pentest;
  proxy_ssl_server_name on;
  proxy_ssl_verify off;
  proxy_set_header Host $host;
  proxy_set_header X-Forwarded-Proto $scheme;
  proxy_set_header X-Forwarded-For $remote_addr;
}

# Upload razonable para .xlsx
client_max_body_size 25m;

# Temporales en /tmp (con permisos en el Dockerfile)
client_body_temp_path /tmp/nginx_cache/client_body;
proxy_temp_path       /tmp/nginx_cache/proxy;
fastcgi_temp_path     /tmp/nginx_cache/fastcgi;
uwsgi_temp_path       /tmp/nginx_cache/uwsgi;
scgi_temp_path        /tmp/nginx_cache/scgi;
