# --- SPA ---
root /usr/share/nginx/html;
index index.html;
location / { try_files $uri /index.html};

# --- Comunes a webhooks ---
# Aumentar tamaños/tiempos para archivos y procesos largos
client_max_body_size 50m;
proxy_connect_timeout 30s;
proxy_send_timeout    600s;
proxy_read_timeout    600s;

# --- Proxy a n8n (un solo bloque para /webhook/*) ---
location ^~ /webhook/ {
  # IMPORTANTE: proxy a la raíz del upstream (sin path) para reenviar el URI completo
  proxy_pass https://n8n-n8n.apps.focus-ocp-sno-virt.datco.net;

  # HTTP/1.1 + streaming del body (evita 400 con multipart)
  proxy_http_version 1.1;
  proxy_request_buffering off;

  # Host/SNI del upstream (NO el de tu app)
  proxy_set_header Host $proxy_host;
  proxy_ssl_server_name on;
  proxy_ssl_verify off;

  # Encabezados estándar
  proxy_set_header X-Forwarded-Proto $scheme;
  proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;

  # Mantener el URI y query tal cual
  proxy_set_header X-Original-URI $request_uri;
}
